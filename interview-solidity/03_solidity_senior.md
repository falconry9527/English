## gas优化
```
一.常规优化
在存储中使用 uint256 代替较小的整数类型，以避免打包和解包的额外成本。
使用 memory, 存储 参数 和 临时变量 ，以降低存储的gas 消耗。
使用 calldata 存储 外部函数参数，以降低存储的gas 消耗。

二.代码架构的优化：
a. 使用 Merkle 树作为白名单，以降低存储成本。
b. iziswap: 每次swap ,lp的userFee都会变化，如果每次计算 ，很消耗gas，怎么解决
1. 定时批量更新（Batching Updates）: 每10分钟更新一次
2. 当用户查看的时候更新
c. 链上只完成核心逻辑，复杂计算给到链下（比如： 数据监控，数据统计 等）

```

## 安全问题
```
女巫攻击 ：使用基于 Merkle 树的白名单机制，防止 Sybil 攻击

防止密钥丢失或被盗： 
使用多重签名机制，防止密钥丢失或被盗（OpenZeppelin 的 AccessControl + 自定义签名验证）。
如果管理员想要提取交易费，需要至少 5 名管理员中的 3 名批准。
    
重入攻击防护 ：
1. 使用 ReentrancyGuard 合约防止重入攻击。
2. 先检查,再修改状态, 最后 交互/资产转账（Check-Effect-Interaction）
3. 拉取支付（Pull Over Push）模式: 不直接向用户发送资金，而是让用户主动提取。
   swap burn : 存入余额，让用户自己提取，而不是直接转账给账户

规范代码习惯: 不能随意调整变量的大小和顺序
```

##  UUPS 和 透明代理（Transparent Proxy）的区别
```
Transparent Proxy: 升级逻辑在代理合约，更费gas，更安全
UUPS ：升级逻辑在实现合约，更节省gas
```

## 代理合约中的存储冲突是什么
```
代理合约中的存储冲突是因为 delegatecall 在 Proxy 的存储上下文中执行 Logic 代码，
如果两者（代理合约和升级合约）声明的状态变量使用了相同 storage slot，
就会覆盖或破坏数据，需要使用标准槽位或非结构化存储模式避免冲突。
用于 Proxy 合约关键（assembly）变量的固定 storage slot 
```


## 什么是 TWAP？
```
TWAP = 时间加权平均价格
核心优势：平滑价格，降低瞬时操纵风险
DeFi 中典型实现：
利用累计价格差 / 时间间隔计算
常用于抵押品估值、套利检测、交易策略

```



